#!/bin/bash

# Thoát nếu có lỗi
set -e

# Lấy đường dẫn của app
APP_DIR="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")" && pwd)"
export APP_DIR

# Source các biến môi trường
source "$APP_DIR/env/app"
source "$APP_ENV_DIR/theme"

# Source các utility functions
source "$APP_SETUP_UTILS_DIR/download.sh"

# Tạo symlink
ln -sf "$APP_DIR"/run "$HOME/.local/bin/$APP_NAME_LOWER"

# Hàm để hiển thị hướng dẫn sử dụng
show_usage() {
    echo "Cách sử dụng: $APP_NAME_LOWER [TÙY_CHỌN]"
    echo ""
    echo "Các tùy chọn:"
    echo "  --help, -h          Hiển thị hướng dẫn"
    echo "  --install, -i       Cài đặt packages và cấu hình"
    echo "  --update, -u        Cập nhật cấu hình nào đó hoặc tất cả"
    echo "  --exec, -x          Thực thi script"
}

# Xử lý các tham số dòng lệnh
if [[ $# -eq 0 ]]; then
    show_usage
    exit 0
else
    case "$1" in
        --help|-h)
            show_usage
            exit 0
            ;;
        --install|-i)
            source "$APP_SETUP_DIR/install.sh" "$@"
            ;;
        --update|-u)
            source "$APP_SETUP_DIR/update.sh" "$@"
            ;;
        --exec|-x)
            source "$APP_SCRIPTS_DIR/exec.sh" "$@"
            ;;
        *)
            echo "Lỗi: Tuỳ chọn không hợp lệ '$1'"
            show_usage
            exit 1
            ;;
    esac
fi
